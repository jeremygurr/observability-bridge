/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.ple.observabilityBridge;

import com.ple.util.IArrayList;
import com.ple.util.IList;
import com.ple.util.IMap;

import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

/**
 * Should only be used by a single thread. If it is needed in another thread, pass a cloned instance.
 */
public class RecordingService {

  public final List<RecordingHandler> handlers;
  public final List<String> contextList;
  public final List<Long> startTimeList;

  private RecordingService(List<RecordingHandler> handlers, List<String> contextList, List<Long> startTimeList) {
    this.handlers = handlers;
    this.contextList = contextList;
    this.startTimeList = startTimeList;
  }

  public static RecordingService make(RecordingHandler... handlers) {
    return new RecordingService(List.of(handlers), new ArrayList<>(), new ArrayList<>());
  }

  public RecordingService open(String context, IMap<String, String> lowCard, IMap<String, String> highCard) {
    startTimeList.add(System.currentTimeMillis());
    contextList.add(context);

    for (RecordingHandler handler : handlers) {
      handler.open(this, context, lowCard, highCard);
    }

    return this;
  }

  public RecordingService open(String context, IMap<String, String> lowCard) {
    return open(context, lowCard, null);
  }

  public RecordingService open(String context) {
    return open(context, null, null);
  }

  public RecordingService clone() {
    return new RecordingService(new ArrayList(handlers), new ArrayList(contextList), new ArrayList(startTimeList));
  }

}
